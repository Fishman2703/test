<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì± –°–∫–∞–Ω–µ—Ä –ë–ñ–£ | –ê–Ω–∞–ª–∏–∑ –ø–∏—Ç–∞–Ω–∏—è</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="control-panel">
        <button id="themeToggle" class="theme-toggle" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
            <i class="fas fa-moon"></i>
        </button>
        <button id="closeApp" class="close-btn" title="–ó–∞–∫—Ä—ã—Ç—å">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <header>
            <h1>–°–∫–∞–Ω–µ—Ä –ë–ñ–£</h1>
            <p>–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥ –ø—Ä–æ–¥—É–∫—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏</p>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill" style="width: 0%"></div>
            </div>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ–∫—Ü–∏—è -->
        <main>
            <!-- –°–µ–∫—Ü–∏—è —Å–∫–∞–Ω–µ—Ä–∞ -->
            <section class="section scanner-section">
                <h2 class="section-title">
                    <i class="fas fa-camera"></i>
                    –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                </h2>
                
                <div id="qr-reader" class="camera-placeholder">
                    <div class="scanner-placeholder">
                        <i class="fas fa-barcode" style="font-size: 48px; color: var(--text-muted); margin-bottom: 15px;"></i>
                        <p style="color: var(--text-secondary);">–°–∫–∞–Ω–µ—Ä –æ—Ç–∫–ª—é—á–µ–Ω</p>
                        <p style="color: var(--text-muted); font-size: 14px; margin-top: 10px;">
                            –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã
                        </p>
                    </div>
                </div>
                
                <div class="scanner-controls" style="text-align: center; margin-top: 20px;">
                    <button id="startScanner" class="btn btn-primary">
                        <i class="fas fa-play"></i>
                        –í–∫–ª—é—á–∏—Ç—å —Å–∫–∞–Ω–µ—Ä
                    </button>
                    <button id="stopScanner" class="btn btn-secondary hidden">
                        <i class="fas fa-stop"></i>
                        –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </section>

            <!-- –†—É—á–Ω–æ–π –≤–≤–æ–¥ -->
            <section class="section manual-input">
                <h2 class="section-title">
                    <i class="fas fa-keyboard"></i>
                    –†—É—á–Ω–æ–π –≤–≤–æ–¥
                </h2>
                
                <div class="input-group">
                    <input type="text" id="manualBarcode" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 5901234123457)"
                           maxlength="13">
                    <button id="checkManual" class="btn btn-primary">
                        <i class="fas fa-search"></i>
                        –ù–∞–π—Ç–∏
                    </button>
                </div>
                
                <div class="test-codes" style="margin-top: 15px;">
                    <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">
                        –¢–µ—Å—Ç–æ–≤—ã–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥—ã:
                    </p>
                    <span class="code-chip" data-code="3017620422003">Nutella</span>
                    <span class="code-chip" data-code="7622210288257">Oreo</span>
                    <span class="code-chip" data-code="4014400900508">Red Bull</span>
                    <span class="code-chip" data-code="5449000000996">Coca-Cola</span>
                </div>
            </section>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
            <section id="result" class="section result hidden">
                <h2 class="section-title">
                    <i class="fas fa-chart-pie"></i>
                    –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞
                </h2>
                
                <div class="product-header">
                    <div class="product-title">
                        <h2 id="productName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</h2>
                        <span class="product-barcode" id="barcode">0000000000000</span>
                    </div>
                    <button id="saveProduct" class="btn btn-success" style="min-width: auto;">
                        <i class="fas fa-bookmark"></i>
                    </button>
                </div>
                
                <div class="nutrition-grid">
                    <div class="nutrient">
                        <span class="nutrient-icon">üî•</span>
                        <div class="nutrient-label">–ö–∞–ª–æ—Ä–∏–∏</div>
                        <div class="nutrient-value" id="calories">0</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">–∫–∫–∞–ª</div>
                    </div>
                    
                    <div class="nutrient">
                        <span class="nutrient-icon">ü•©</span>
                        <div class="nutrient-label">–ë–µ–ª–∫–∏</div>
                        <div class="nutrient-value" id="protein">0</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">–≥—Ä–∞–º–º</div>
                    </div>
                    
                    <div class="nutrient">
                        <span class="nutrient-icon">ü•ë</span>
                        <div class="nutrient-label">–ñ–∏—Ä—ã</div>
                        <div class="nutrient-value" id="fat">0</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">–≥—Ä–∞–º–º</div>
                    </div>
                    
                    <div class="nutrient">
                        <span class="nutrient-icon">üçû</span>
                        <div class="nutrient-label">–£–≥–ª–µ–≤–æ–¥—ã</div>
                        <div class="nutrient-value" id="carbs">0</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">–≥—Ä–∞–º–º</div>
                    </div>
                </div>
                
                <div class="product-info">
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">
                        <i class="fas fa-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ
                    </h3>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">–ë—Ä–µ–Ω–¥:</span>
                            <span class="info-value" id="brand">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                        </div>
                        
                        <div class="info-item">
                            <span class="info-label">–í–µ—Å/–û–±—ä—ë–º:</span>
                            <span class="info-value" id="weight">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                        </div>
                        
                        <div class="info-item">
                            <span class="info-label">–î–∞—Ç–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</span>
                            <span class="info-value" id="scanDate">-</span>
                        </div>
                        
                        <div class="info-item">
                            <span class="info-label">–°—Ç–∞—Ç—É—Å:</span>
                            <span class="info-value" id="productStatus">
                                <span style="color: var(--success-color);">
                                    <i class="fas fa-check-circle"></i> –ù–∞–π–¥–µ–Ω–æ
                                </span>
                            </span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- –ò—Å—Ç–æ—Ä–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π -->
            <section class="section history">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 class="section-title" style="margin: 0;">
                        <i class="fas fa-history"></i>
                        –ò—Å—Ç–æ—Ä–∏—è
                    </h2>
                    <button id="clearHistory" class="btn btn-danger" style="min-width: auto; padding: 8px 12px;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                
                <div id="historyList" class="history-items">
                    <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
                </div>
                
                <p style="text-align: center; color: var(--text-muted); font-size: 14px; margin-top: 15px;">
                    <i class="fas fa-info-circle"></i>
                    –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–∞–ø–∏—Å—å –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
                </p>
            </section>

            <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
            <section class="section instructions">
                <h2 class="section-title">
                    <i class="fas fa-question-circle"></i>
                    –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?
                </h2>
                
                <ol class="instructions-list">
                    <li>–ù–∞–∂–º–∏—Ç–µ "–í–∫–ª—é—á–∏—Ç—å —Å–∫–∞–Ω–µ—Ä" –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ</li>
                    <li>–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ —à—Ç—Ä–∏—Ö-–∫–æ–¥ –ø—Ä–æ–¥—É–∫—Ç–∞</li>
                    <li>–î–æ–∂–¥–∏—Ç–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è</li>
                    <li>–ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏</li>
                    <li>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç –≤ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</li>
                </ol>
                
                <div style="margin-top: 20px; padding: 15px; background: var(--bg-tertiary); border-radius: var(--radius-sm);">
                    <h4 style="color: var(--text-primary); margin-bottom: 10px;">
                        <i class="fas fa-lightbulb"></i> –°–æ–≤–µ—Ç—ã –ø–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é
                    </h4>
                    <ul style="color: var(--text-secondary); font-size: 14px; margin-left: 20px;">
                        <li>–û–±–µ—Å–ø–µ—á—å—Ç–µ —Ö–æ—Ä–æ—à–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ</li>
                        <li>–î–µ—Ä–∂–∏—Ç–µ –∫–∞–º–µ—Ä—É –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —à—Ç—Ä–∏—Ö-–∫–æ–¥—É</li>
                        <li>–ò–∑–±–µ–≥–∞–π—Ç–µ –±–ª–∏–∫–æ–≤ –∏ –æ—Ç—Ä–∞–∂–µ–Ω–∏–π</li>
                        <li>–ï—Å–ª–∏ –Ω–µ —É–¥–∞—ë—Ç—Å—è –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥</li>
                    </ul>
                </div>
            </section>
        </main>

        <!-- –§—É—Ç–µ—Ä -->
        <footer style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color);">
            <p style="text-align: center; color: var(--text-muted); font-size: 13px;">
                <i class="fas fa-database"></i>
                –î–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è Open Food Facts API
                <br>
                <span style="font-size: 12px;">¬© 2024 –°–∫–∞–Ω–µ—Ä –ë–ñ–£ | v1.0</span>
            </p>
        </footer>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div id="notification" class="notification hidden"></div>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
    <script src="app.js"></script>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É —Ç–µ–º—ã
            const themeIcon = document.querySelector('#themeToggle i');
            themeIcon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
            document.getElementById('themeToggle').addEventListener('click', function() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ–≤—É—é —Ç–µ–º—É
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
                const icon = this.querySelector('i');
                icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showNotification(`–¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ ${newTheme === 'dark' ? '—Ç—ë–º–Ω—É—é' : '—Å–≤–µ—Ç–ª—É—é'}`);
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            document.getElementById('closeApp').addEventListener('click', function() {
                if (window.Telegram && Telegram.WebApp && Telegram.WebApp.close) {
                    Telegram.WebApp.close();
                } else {
                    if (confirm('–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?')) {
                        window.close();
                    }
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–≤
            document.querySelectorAll('.code-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    const barcode = this.dataset.code;
                    document.getElementById('manualBarcode').value = barcode;
                    document.getElementById('checkManual').click();
                    
                    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —á–∏–ø
                    document.querySelectorAll('.code-chip').forEach(c => {
                        c.style.background = '';
                        c.style.color = '';
                    });
                    this.style.background = 'var(--accent-color)';
                    this.style.color = 'white';
                });
            });
            
            // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            window.showNotification = function(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.style.background = type === 'success' ? 'var(--success-color)' : 
                                               type === 'error' ? 'var(--danger-color)' : 
                                               type === 'warning' ? 'var(--warning-color)' : 
                                               'var(--info-color)';
                
                notification.classList.remove('hidden');
                
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 3000);
            };
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
            function updateProgressBar() {
                const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrolled = (winScroll / height) * 100;
                document.getElementById("progressFill").style.width = scrolled + "%";
            }
            
            window.addEventListener('scroll', updateProgressBar);
            
            // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('manualBarcode').focus();
        });
    </script>
</body>
</html>